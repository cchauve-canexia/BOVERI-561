# BOVERI-561
Extract indel calls from commercial samples.

The list of commercial samples run IDs is in BOVERI-532. The corresponding input
file is in `data/BOVERI-532.csv`.

## Run-specific results

The code in this repo generates one TSV file per run, containing the list of
all (almost) unfiltered indels. The only filters that have been applied are
- discarding alignments with at least 5 gaps from variants support,
- filtering out variants supported by an alignment in a low-quality region
  defined as a region of 3 bases pre and post breakpoint with an average quality
  within a read cluster that is at most 20 for all bases of the considered
  region.

Each entry in the TSV file for a run contains the usual fields of a variant
(chromosome, position, reference sequence, alternate sequence, VAF) plus the
following fields
- sample: sample ID where the variant was observed
- run_id: run ID containing this sample
- run_name: run name
- v_type: DEL, INS, DELINS, MNV
- score: penalty associated to the variant (high penalty implies low confidence)
- complexity: penalty associated to the complexity of the sequence around the
              breakpoint (5 bases pre and post)
- support: support penalty associated to the size of the largest cluster
           supporting the variant
- overlap: overlap penalty associated to the VAF of overlapping variants
- control: closest VAF of the same variant in a control sample (0.0 if not
           present in a control sample)
- cov: coverage of the amplicon(s) by merged reads (a merged read corresponds
       to two reads)
- alt_cov: coverage of the variant by merged reads
- max_cov: size (in number of merged reads) of the largest supporting cluster
- repeats: WT1:WT2:WT3:WT4,V1:V2:V3:V4
    WT1 = length of the repeat unit of the reference sequence
    WT2 = number of copies of the repeat unit in the reference sequence
    WT3 = number of copies of the repeat unit left of variant breakpoint
    WT4 = number of copies of repeat unit right of variant breakpoint
    V1, V2, V3,  V4: same for alternate sequence
- annotation: snpEff annotation

## Aggregated results

The directory results contains a list of files prefixed by
```v4MiSeq_commercial_samples_expected_indels_ExpectedVAFs_MissingSeraSeq```

These files contains an aggregated analysis of the calling performances of the
indels pipeline, split per 15 settings defined in terms of expected VAF and
DNA amount input.

For an expected VAF range (v1, v2] and a DNA amount range (d1, d2], the input
file of expected indels is
```data/v4MiSeq_commercial_samples_expected_indels_ExpectedVAFs_MissingSeraSeq_VAF_NG_{v1}_{v2}_{d1}_{d2}.tsv```
and the analysis files generated by the analysis script are  the following.  

```results/v4MiSeq_commercial_samples_expected_indels_ExpectedVAFs_MissingSeraSeq_VAF_NG_{v1}_{v2}_{d1}_{d2}_with_blacklist_out.tsv```
contains the accuracy statistics for the pipeline over a wide grid of parameters.

```results/v4MiSeq_commercial_samples_expected_indels_ExpectedVAFs_MissingSeraSeq_VAF_NG_{v1}_{v2}_{d1}_{d2}_with_blacklist_errors.txt```
contains the list of all FP and FN indels.

```results/v4MiSeq_commercial_samples_expected_indels_ExpectedVAFs_MissingSeraSeq_VAF_NG_{v1}_{v2}_{d1}_{d2}_with_blacklist_vaf.tsv```
contains the observed and detected VAF for all FP and FN indels.

The files where '''with_blacklist``` is replaced by ```optimal_thresholds_with_blacklist```
contain the same information but for a subset of thresholds considered as giving optimal results.

The files where '''with_blacklist``` is replaced by ```optimal_thresholds_no_blacklist```
contain the same information but for a subset of thresholds considered as giving optimal results and
where the blacklisted indels have been included.

The file
```v4MiSeq_commercial_samples_expected_indels_ExpectedVAFs_MissingSeraSeq_VAF_NG_F1_095.txt```
contains the list of optimal thresholds for every setting, where a threshold setting is defined
as one that gives results within 95% of the best F1 statistics.

The file
``` v4MiSeq_commercial_samples_expected_indels_ExpectedVAFs_MissingSeraSeq_summary.md```
provides a summary of these analysis.
